<!DOCTYPE html>
<html>
	<head> 
		<meta charset="UTF-8">
		<title>反一个顶俩</title>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
		<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/clipboard.js/2.0.4/clipboard.min.js"></script>
		<link href="https://cdn.bootcss.com/hint.css/2.6.0/hint.base.min.css" rel="stylesheet">
		<link href="primer.css" rel="stylesheet">
		<script type="text/javascript">
			var copy_shortest = '';
			var copy_farthest = '';
			var copy_loop = '';
			var nodis = [], nopre = [];
			var loopdis = [], looppre = [];
			var igraph = [];
			function getdis()
			{
				for (var u in graph) igraph[u] = [];
				for (var u in graph)
				{
					for (var v in graph[u])
					{
						igraph[v][u] = graph[u][v];
					}
				}
				var q = new Array();
				var ql = 0, qr = -1;
				for (var u in graph)
				{
					if (Object.keys(igraph[u]).length == 0)
					{
						nodis[u] = 0;
						q.push(u);
						++qr;
					}
				}
				while (ql <= qr)
				{
					var u = q[ql++];
					for (var v in graph[u])
					{
						if (!nodis.hasOwnProperty(v))
						{
							nodis[v] = nodis[u] + 1;
							nopre[v] = u;
							q.push(v);
							++qr;
						}
					}
				}
			}
			function getloop()
			{
				var q = new Array();
				var ql = 0, qr = -1;
				for (var u in graph)
				{
					if (graph[u].hasOwnProperty(u))
					{
						loopdis[u] = 0;
						q.push(u);
						++qr;
					}
				}
				while (ql <= qr)
				{
					var u = q[ql++];
					for (var v in graph[u])
					{
						if (!loopdis.hasOwnProperty(v))
						{
							loopdis[v] = loopdis[u] + 1;
							looppre[v] = u;
							q.push(v);
							++qr;
						}
					}
				}
			}
			function jsonloaded()
			{
				var shortestClipboard = new ClipboardJS('.shortest-btn', {
				    text: function(trigger) {
				        return copy_shortest;
				    }
				});
				var farthestClipboard = new ClipboardJS('.farthest-btn', {
				    text: function(trigger) {
				        return copy_farthest;
				    }
				});
				var loopClipboard = new ClipboardJS('.loop-btn', {
				    text: function(trigger) {
				        return copy_loop;
				    }
				});
				function showTooltip(elem, msg) {
					if (!elem.classList.contains('hint--right')) {
					    var classNames = elem.className;
					    elem.setAttribute('class', classNames + ' hint--right');
					    elem.setAttribute('aria-label', msg);
					    setTimeout(function () {
					        elem.setAttribute('class', classNames);
					        elem.removeAttribute('aria-label');
					    }, 1200);
					}
				}
				shortestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				farthestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				loopClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				$(function()
				{
				    $('#from-word').bind('keydown', function(event)
				    {
				        if (event.keyCode == "13") submit();
				        else if (event.keyCode == "40") document.getElementById('shortest-result').focus();
				    });
				});
				$(function()
				{
				    $('#shortest-result').bind('keydown', function(event)
				    {
				        if (event.keyCode == "38") document.getElementById('from-word').focus();
				        else if (event.keyCode == "40" || event.keyCode == "13") document.getElementById('farthest-result').focus();
				        else if (event.ctrlKey && event.keyCode == "65") $(this).select();
				    });
				});
				$(function()
				{
				    $('#farthest-result').bind('keydown', function(event)
				    {
				        if (event.keyCode == "38") document.getElementById('shortest-result').focus();
				        else if (event.keyCode == "40" || event.keyCode == "13") document.getElementById('loop-result').focus();
				        else if (event.ctrlKey && event.keyCode == "65") $(this).select();
				    });
				});
				$(function()
				{
				    $('#loop-result').bind('keydown', function(event)
				    {
				        if (event.keyCode == "38") document.getElementById('farthest-result').focus();
				        else if (event.ctrlKey && event.keyCode == "65") $(this).select();
				    });
				});
				getdis();
				getloop();
				var loadingdiv = document.getElementById('loading');
				var maindiv = document.getElementById('main');
				loadingdiv.style.display='none';
				maindiv.style.display='block';
				document.getElementById("from-word").focus();
			}
			function getShortest(from)
			{
				if (nodis[from] == 0) return '已经无法接下去了';
				if (nodis[from] == 1) return graph[nopre[from]][from];
				return graph[nopre[from]][from] + ' → ' + getShortest(nopre[from]);
			}
			function getFarthest(from)
			{
				var farthest = -1;
				var farthest_v = 0;
				for (v in igraph[from])
				{
					if (nodis[v] > farthest)
					{
						farthest = nodis[v];
						farthest_v = v;
					}
				}
				return igraph[from][farthest_v] + ' (' + getShortest(farthest_v) + ')';
			}
			function getLoop(from)
			{
				if (loopdis[from] == 0) return graph[from][from];
				return graph[looppre[from]][from] + ' → ' + getLoop(looppre[from]);
			}
			function submit()
			{
				var from = document.getElementById('from-word').value;
				if (!graph.hasOwnProperty(from))
				{
					alert('无法识别拼音 "' + from + '"，可能是因为数据库中没有以此拼音开头或结尾的成语。');
					return;
				}
				if (nodis[from] == 0)
				{
					document.getElementById('shortest-result').value = '已经无法接下去了';
					document.getElementById('farthest-result').value = '已经无法接下去了';
					document.getElementById('loop-result').value = '已经无法接下去了';
					copy_loop = copy_farthest = copy_shortest = '';
					return;
				}
				document.getElementById('shortest-result').value = getShortest(from);
				document.getElementById('farthest-result').value = getFarthest(from);
				document.getElementById('loop-result').value = getLoop(from);
				copy_shortest = document.getElementById('shortest-result').value.split(' ')[0];
				copy_farthest = document.getElementById('farthest-result').value.split(' ')[0];
				copy_loop = document.getElementById('loop-result').value.split(' ')[0];
			}
		</script>
		<style>
			.clippy
			{
				vertical-align: middle;
			}
			.before-input-group
			{
				display: table-cell;
				vertical-align: middle;
				text-align: center;
				width: 84px;
			}
		</style>
	</head>
	<body style="margin-left: 20px; margin-top: 20px; font-size: 14px;">
		<div id="loading" style="display:block;">
			<p>数据加载中，请稍候...</p>
		</div>
		<div id="main" style="display:none;">
			<div id="input-part" style="border-radius: 4px 4px 0 0; border: 1px solid #ddd; white-space: nowrap; display: inline-block;">
				<div style="display: inline-block; margin-left: 10px; margin-right: 10px;">
					<p>当前拼音：<input type="text" id="from-word" ></p>
					<p><button class="btn" id="submit-button" onclick="submit()">提交 (Press Enter)</button></p>
				</div>
			</div>
			<br>
			<br>
			<div id="output-part" style="width: 500px; border-radius: 4px 4px 0 0; border: 1px solid #ddd;">
				<div style="margin-left: 10px; margin-right: 10px;">
					<p>
						<div style="display: table; width: 100%">
							<div class="before-input-group">最近无法接：</div>
							<div class="input-group" style="width: 100%">
								<input id="shortest-result" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn shortest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>
						<div style="display: table; width: 100%">
							<div class="before-input-group">最远无法接：</div>
							<div class="input-group" style="width: 100%">
								<input id="farthest-result" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn farthest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>
						<div style="display: table; width: 100%">
							<div class="before-input-group">最近循环：</div>
							<div class="input-group" style="width: 100%">
								<input id="loop-result" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn loop-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
				</div>
			</div>
			<br>
			<br>
			<div id="links">
				<p><a href="https://github.com/ouuan/Anti-YiGeDingLia/issues">有 bug?</a></p>
				<p><a href="https://github.com/ouuan/Anti-YiGeDingLia">Github Repo</a></p>
				<p><a href="/">返回博客首页</a></p>
			</div>
		</div>
		<script type="text/javascript" src="yigedinglia.json" onload="jsonloaded()"></script>
	</body> 
</html> 