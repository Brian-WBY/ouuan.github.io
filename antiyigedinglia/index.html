<!DOCTYPE html>
<html>
	<head> 
		<meta charset="UTF-8">
		<title>反一个顶俩</title>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
		<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/clipboard.js/2.0.4/clipboard.min.js"></script>
		<link href="https://cdn.bootcss.com/hint.css/2.6.0/hint.base.min.css" rel="stylesheet">
		<link href="primer.css" rel="stylesheet">
		<script type="text/javascript">
			var copy_shortest = '';
			var copy_farthest = '';
			var dis = [], pre = [];
			function getdis()
			{
				for (var from in graph)
				{
					dis[from] = [];
					pre[from] = [];
					dis[from][from] = 0;
					var q = new Array();
					var ql = 0, qr = 0;
					q.push(from);
					while (ql <= qr)
					{
						var u = q[ql++];
						for (var v in graph[u])
						{
							if (!dis[from].hasOwnProperty(v))
							{
								dis[from][v] = dis[from][u] + 1;
								pre[from][v] = u;
								q.push(v);
								++qr;
							}
						}
					}
				}
			}
			function jsonloaded()
			{
				var shortestClipboard = new ClipboardJS('.shortest-btn', {
				    text: function(trigger) {
				        return copy_shortest;
				    }
				});
				var farthestClipboard = new ClipboardJS('.farthest-btn', {
				    text: function(trigger) {
				        return copy_farthest;
				    }
				});
				function showTooltip(elem, msg) {
					if (!elem.classList.contains('hint--right')) {
					    var classNames = elem.className;
					    elem.setAttribute('class', classNames + ' hint--right');
					    elem.setAttribute('aria-label', msg);
					    setTimeout(function () {
					        elem.setAttribute('class', classNames);
					        elem.removeAttribute('aria-label');
					    }, 1200);
					}
				}
				shortestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				farthestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				$(function()
				{
				    $('#from-word').bind('keydown', function(event)
				    {
				        if (event.keyCode == "13" || event.keyCode == "40")    
				        {
				        	document.getElementById('destination-word').focus();
				        }
				    });
				});
				$(function()
				{
				    $('#destination-word').bind('keydown', function(event)
				    {
				        if (event.keyCode == "13")
				        {
				        	submit();
				        	document.getElementById('shortest-path').focus();
				        }
				        else if (event.keyCode == "38") document.getElementById('from-word').focus();
				        else if (event.keyCode == "40") document.getElementById('shortest-path').focus();
				    });
				});
				$(function()
				{
				    $('#shortest-path').bind('keydown', function(event)
				    {
				        if (event.keyCode == "38") document.getElementById('destination-word').focus();
				        else if (event.keyCode == "40" || event.keyCode == "13") document.getElementById('farthest-next').focus();
				        else if (event.ctrlKey && event.keyCode == "65") $(this).select();
				    });
				});
				$(function()
				{
				    $('#farthest-next').bind('keydown', function(event)
				    {
				        if (event.keyCode == "38") document.getElementById('shortest-path').focus();
				        else if (event.ctrlKey && event.keyCode == "65") $(this).select();
				    });
				});
				getdis();
				var loadingdiv = document.getElementById('loading');
				var maindiv = document.getElementById('main');
				loadingdiv.style.display='none';
				maindiv.style.display='block';
				document.getElementById("from-word").focus();
			}
			function getShortestPath(from, to)
			{
				if (graph[from].hasOwnProperty(to)) return graph[from][to];
				return getShortestPath(from, pre[from][to]) + ' → ' + graph[pre[from][to]][to];
			}
			function submit()
			{
				var from = document.getElementById('from-word').value;
				var to = document.getElementById('destination-word').value;
				var shortest_path_element = document.getElementById('shortest-path');
				var farthest_next_element = document.getElementById('farthest-next');
				if (!graph.hasOwnProperty(from))
				{
					alert('无法识别拼音 ' + from + '，可能是因为数据库中没有以此拼音开头或结尾的成语。');
					return;
				}
				if (!graph.hasOwnProperty(to))
				{
					alert('无法识别拼音 ' + to + '，可能是因为数据库中没有以此拼音开头或结尾的成语。');
					return;
				}
				if (!dis[from].hasOwnProperty(to))
				{
					shortest_path_element.value = farthest_next_element.value = '从起点无法到达终点';
					copy_shortest = copy_farthest = '';
					return;
				}
				if (from == to)
				{
					var shortest = 114514;
					var shortest_v = 0;
					var farthest = -1;
					var farthest_v = 0;
					for (var v in graph[from])
					{
						if (dis[v].hasOwnProperty(from))
						{
							if (dis[v][from] > farthest)
							{
								farthest = dis[v][from];
								farthest_v = v;
							}
							if (dis[v][from] < shortest)
							{
								shortest = dis[v][from];
								shortest_v = v;
							}
						}
					}
					if (shortest_v == 0)
					{
						shortest_path_element.value = farthest_next_element.value = '起点与终点相同且离开起点后无法返回';
						copy_shortest = copy_farthest = '';
					}
					else
					{
						if (shortest == 0) shortest_path_element.value = graph[from][from];
						else shortest_path_element.value = graph[from][shortest_v] + ' → ' + getShortestPath(shortest_v, from);
						if (farthest == 0) farthest_next_element.value = graph[from][from];
						else farthest_next_element.value = graph[from][farthest_v] + ' (' + getShortestPath(farthest_v, from) + ')';
						copy_shortest = graph[from][shortest_v];
						copy_farthest = graph[from][farthest_v];
					}
				}
				else
				{
					var farthest = -1;
					var farthest_v = 0;
					for (var v in graph[from])
					{
						if (dis[v].hasOwnProperty(to))
						{
							if (dis[v][to] > farthest)
							{
								farthest = dis[v][to];
								farthest_v = v;
							}
						}
					}
					var shortest_path = shortest_path_element.value = getShortestPath(from, to);
					copy_shortest = shortest_path.split(' ')[0];
					farthest_next_element.value = graph[from][farthest_v] + ' (' + getShortestPath(farthest_v, to) + ')';
					copy_farthest = graph[from][farthest_v];
				}
			}
		</script>
		<style>
			.clippy
			{
				vertical-align: middle;
			}
			.before-input-group
			{
				display: table-cell;
				vertical-align: middle;
				text-align: center;
				width: 84px;
			}
		</style>
	</head>
	<body style="margin-left: 20px; margin-top: 20px; font-size: 14px;">
		<div id="loading" style="display:block;">
			<p>数据加载中，请稍候...</p>
		</div>
		<div id="main" style="display:none;">
			<div id="input-part" style="border-radius: 4px 4px 0 0; border: 1px solid #ddd; white-space: nowrap; display: inline-block;">
				<div style="display: inline-block; margin-left: 10px; margin-right: 10px;">
					<p>起点：<input type="text" id="from-word" >（从哪个拼音开始）</p>
					<p>终点：<input type="text" id="destination-word" value="lia">（接到哪个拼音）</p>
					<p><button class="btn" id="submit-button" onclick="submit()">提交 (Press Enter)</button></p>
				</div>
			</div>
			<br>
			<br>
			<div id="output-part" style="width: 500px; border-radius: 4px 4px 0 0; border: 1px solid #ddd;">
				<div style="margin-left: 10px; margin-right: 10px;">
					<p>
						<div style="display: table; width: 100%">
							<div class="before-input-group">最短路：</div>
							<div class="input-group" style="width: 100%">
								<input id="shortest-path" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn shortest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>
						<div style="display: table; width: 100%">
							<div class="before-input-group">最远下一个：</div>
							<div class="input-group" style="width: 100%">
								<input id="farthest-next" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn farthest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>tips: “最远下一个”是指能接到的下一个成语中离终点最远的那一个。</p>
				</div>
			</div>
			<br>
			<br>
			<div id="links">
				<p><a href="https://github.com/ouuan/Anti-YiGeDingLia/issues">有 bug?</a></p>
				<p><a href="https://github.com/ouuan/Anti-YiGeDingLia">Github Repo</a></p>
				<p><a href="/">返回博客首页</a></p>
			</div>
		</div>
		<script type="text/javascript" src="yigedinglia.json" onload="jsonloaded()"></script>
	</body> 
</html> 