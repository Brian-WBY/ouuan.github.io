<!DOCTYPE html>
<html>
	<head> 
		<meta charset="UTF-8">
		<title>反一个顶俩</title>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
		<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/clipboard.js/2.0.4/clipboard.min.js"></script>
		<link href="https://cdn.bootcss.com/hint.css/2.6.0/hint.base.min.css" rel="stylesheet">
		<link href="primer.css" rel="stylesheet">
		<script type="text/javascript">
			var copy_shortest = '';
			var copy_farthest = '';
			function jsonloaded()
			{
				var shortestClipboard = new ClipboardJS('.shortest-btn', {
				    text: function(trigger) {
				        return copy_shortest;
				    }
				});
				var farthestClipboard = new ClipboardJS('.farthest-btn', {
				    text: function(trigger) {
				        return copy_farthest;
				    }
				});
				function showTooltip(elem, msg) {
					if (!elem.classList.contains('hint--right')) {
					    var classNames = elem.className;
					    elem.setAttribute('class', classNames + ' hint--right');
					    elem.setAttribute('aria-label', msg);
					    setTimeout(function () {
					        elem.setAttribute('class', classNames);
					        elem.removeAttribute('aria-label');
					    }, 1200);
					}
				}
				shortestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				farthestClipboard.on('success', event => {
				    if (event.text) {
				        showTooltip(event.trigger, 'Copied!');
				    }
				});
				var loadingdiv = document.getElementById('loading');
				var maindiv = document.getElementById('main');
				loadingdiv.style.display='none';
				maindiv.style.display='block';
				document.getElementById("from-word").focus();
			}
			$(function()
			{
			    $('#from-word').bind('keypress', function(event)
			    {
			        if (event.keyCode == "13")    
			        {
			        	document.getElementById('destination-word').focus();
			        }
			    });
			});
			$(function()
			{
			    $('#destination-word').bind('keypress', function(event)
			    {
			        if (event.keyCode == "13")    
			        {
			        	submit();
			        }
			    });
			});
			function submit()
			{
				var from = document.getElementById('from-word').value;
				var to = document.getElementById('destination-word').value;
				var shortest_path_element = document.getElementById('shortest-path');
				var farthest_next_element = document.getElementById('farthest-next');
				if (!dis.hasOwnProperty(from))
				{
					alert('无法识别拼音 ' + from + '，可能是因为数据库中没有以此拼音开头或结尾的成语。');
					return;
				}
				if (!dis.hasOwnProperty(to))
				{
					alert('无法识别拼音 ' + to + '，可能是因为数据库中没有以此拼音开头或结尾的成语。');
					return;
				}
				if (!dis[from].hasOwnProperty(to))
				{
					shortest_path_element.value = '从起点无法到达终点';
					copy_shortest = '';
					farthest_next_element.value = '从起点无法到达终点';
					copy_farthest = '';
					return;
				}
				var shortest_path = '';
				if (from == to)
				{
					var shortest_v;
					var shortest = 114514;
					var shortest_next = '';
					for (var i = 0; i < graph[from].length; ++i)
					{
						var v = graph[from][i];
						if (dis[v].hasOwnProperty(from) && dis[v][from]['dist'] < shortest)
						{
							shortest_v = v;
							shortest = dis[v][from]['dist'];
							shortest_next = dis[from][v]['word'][0];
						}
					}
					if (shortest == 0)
					{
						shortest_path_element.value = copy_shortest = shortest_next;
					}
					else if (shortest == 114514)
					{
						shortest_path_element.value = '起点与终点相同且从起点出发无法返回起点';
						copy_shortest = '';
					}
					else
					{
						shortest_path = shortest_next;
						for (var i = 0; i < dis[shortest_v][from]['word'].length; ++i)
						{
							shortest_path += ' → ';
							shortest_path += dis[shortest_v][from]['word'][i]
						}
						shortest_path_element.value = shortest_path;
						copy_shortest = shortest_next;
					}
				}
				else
				{
					for (var i = 0; i < dis[from][to]['word'].length; ++i)
					{
						if (i > 0) shortest_path += ' → ';
						shortest_path += dis[from][to]['word'][i]
					}
					shortest_path_element.value = shortest_path;
					copy_shortest = dis[from][to]['word'][0];
				}
				var farthest = -1;
				var farthest_v = 0;
				var farthest_next = '';
				for (var i = 0; i < graph[from].length; ++i)
				{
					var v = graph[from][i];
					if (dis[v].hasOwnProperty(to) && dis[v][to]['dist'] > farthest)
					{
						farthest_v = v;
						farthest = dis[v][to]['dist'];
						farthest_next = dis[from][v]['word'][0];
					}
				}
				if (farthest == -1)
				{
					farthest_next_element.value = '起点与终点相同且从起点出发无法返回起点';
					copy_farthest = '';
				}
				else if (farthest_v == from)
				{
					farthest_next_element.value = copy_farthest = farthest_next;
				}
				else
				{
					shortest_path = '';
					for (var i = 0; i < dis[farthest_v][to]['word'].length; ++i)
					{
						if (i > 0) shortest_path += ' → ';
						shortest_path += dis[farthest_v][to]['word'][i]
					}
					farthest_next_element.value = farthest_next + " (" + shortest_path + ')';
					copy_farthest = farthest_next;
				}
			}
		</script>
	</head>
	<body style="margin-left: 20px; margin-top: 20px;">
		<div id="loading" style="display:block;">
			<p>数据加载中，请稍候...</p>
		</div>
		<div id="main" style="display:none;">
			<div id="input-part" style="border-radius: 4px 4px 0 0; border: 1px solid #ddd; white-space: nowrap; display: inline-block;">
				<div style="display: inline-block; margin-left: 10px; margin-right: 10px;">
					<p>起点：<input type="text" id="from-word" >（从哪个拼音开始）</p>
					<p>终点：<input type="text" id="destination-word" value="lia">（接到哪个拼音）</p>
					<p><button class="btn" id="submit-button" onclick="submit()">提交 (Press Enter)</button></p>
				</div>
			</div>
			<br>
			<br>
			<div id="output-part" style="width: 500px; border-radius: 4px 4px 0 0; border: 1px solid #ddd;">
				<div style="margin-left: 10px; margin-right: 10px;">
					<p>
						<div style="display: table; width: 100%">
							<div style="display: table-cell; vertical-align: middle; text-align: center; width: 80px;">最短路：</div>
							<div class="input-group" style="width: 100%">
								<input id="shortest-path" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn shortest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>
						<div style="display: table; width: 100%">
							<div style="display: table-cell; vertical-align: middle; text-align: center; width: 80px;">最远下一个：</div>
							<div class="input-group" style="width: 100%">
								<input id="farthest-next" type="text" readonly="readonly">
								<span class="input-group-button">
									<button class="btn farthest-btn" type="button">
										<img class="clippy" src="clippy.svg" width="13" alt="复制">
									</button>
								</span>
							</div>
						</div>
					</p>
					<p>tips: “最远下一个”是指能接到的下一个成语中离终点最远的那一个。</p>
				</div>
			</div>
			<br>
			<br>
			<div id="links">
				<p><a href="https://github.com/ouuan/Anti-YiGeDingLia">Github Repo</a></p>
				<p><a href="/">返回博客首页</a></p>
			</div>
		</div>
		<script type="text/javascript" src="yigedinglia.json" onload="jsonloaded()"></script>
	</body> 
</html> 